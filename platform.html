<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>歡迎來到。競標網站</title>
</head>
<?php
session_start();
?>
<style type="text/css">
#banner {
    left: 40px;
}

ul {
    list-style-type: none;
}

#vmenu li a {
    display: block;
    margin: 10px 0px 0px 10px;
    text-decoration: none;
    background-color: white;
    height: 36px;
    width: 150px;
    text-indent: 20px;
    color: black;
    font-size: 15pt;
    line-height: 36px;
    border: 5px solid white;
    border-color: white #999 #999 white;
}

#vmenu li a {
    font-size: 16pt;
    font-family: 標楷體;
}

#vmenu a:hover {
    background-color: gray;
    color: white;
    border: 5px solid white;
    border-color: #999 white white #999;
}

#content {
    border-radius: 10px;
    width: 1000px;
    border: 1px solid #ccc;
    top: 40px;
    left: 20px;
    margin: 40px 10px 10px 27px;
    padding: 20px;
    font-size: 20pt;
    position: absolute;
    font-family: 標楷體;
}

#vmenu {
    position: absolute;
    top: 60px;
    left: 80%;
}
</style>
<script type="text/javascript" src="./js/jquery-3.1.1.min.js"></script>
<script language="javascript">
send();
function send() {
    $.ajax({
        url: './php/sendPresent.php',
        dataType: 'html',
        type: 'POST',
        error: function(response) { //the call back function when ajax call fails
            alert('Ajax request failed!');
        },
        success: function(json) { //the call back function when ajax call succeed
            console.log(json);
        }
    });
}
function loadInfo() {
    $.ajax({
        url: './php/loadOrder.php',
        dataType: 'html',
        type: 'POST',
        error: function(response) { //the call back function when ajax call fails
            alert('Ajax request failed!');
        },
        success: function(json) { //the call back function when ajax call succeed
            //board
            jsdata = jQuery.parseJSON(json);//轉成js能用的
            var data="<tr><th>卡片</th><th>數量</th><th>底價</th><th>剩餘時間(sec)</th><th>目前得標者</th><th>目前得標金額</th><th>競標</th></tr><tr>"
            for(var i=0;i<jsdata.length;i++){
                data+="<td>"+jsdata[i].cname+"</td><td>"+jsdata[i].num+"</td><td>"+jsdata[i].lowprice+"</td>";
                now= new Date();
                tday=new Date(jsdata[i]['time']);
                time=Math.floor((tday-now)/1000)
                if(time<=0){
                    data+="<td>0</td>";
                }else{
                    data+="<td>"+time+"</td>";
                }
                data+="<td>"+jsdata[i].name+"</td><td>"+jsdata[i].price+"</td>";
                data+="<td>/</td></tr>"
            }
            $("#board").html(data);
        }
    });
}
window.onload = function () {
    setInterval(function () {
        loadInfo();

    }, 1000);
    //每5分鐘新增禮包  1000*60*5
    setInterval(function () {
        send();
    }, 300000);
};

</script>

<body>
    <div id="banner">
        <center>
            <h1>管理者頁面</h1>每次登入、每5分鐘自動添加一筆卡片禮包</center>
    </div>
    <fieldset id="content">
        <legend>競標平台</legend>
        <table border=3 cellpadding="5" id="board">
        </table>
    </fieldset>
</body>

</html>
